FROM --platform=$BUILDPLATFORM docker.io/library/golang:1.25.4@sha256:e68f6a00e88586577fafa4d9cefad1349c2be70d21244321321c407474ff9bf2 AS build

ARG TARGETOS
ARG TARGETARCH

ADD . /src
WORKDIR /src

RUN make build

FROM moby/buildkit:v0.26.2-rootless@sha256:0ffa2fcf6b8757c47d569b3ef0f03f9d5eb3b9ff5ce68d858f994f89b749da0c

LABEL maintainer="Robert Kaussow <mail@thegeeklab.de>"
LABEL org.opencontainers.image.authors="Robert Kaussow <mail@thegeeklab.de>"
LABEL org.opencontainers.image.title="wp-buildkit"
LABEL org.opencontainers.image.url="https://github.com/thegeeklab/wp-buildkit"
LABEL org.opencontainers.image.source="https://github.com/thegeeklab/wp-buildkit"
LABEL org.opencontainers.image.documentation="https://github.com/thegeeklab/wp-buildkit"

COPY --from=build /src/dist/wp-buildkit /bin/wp-buildkit
ENTRYPOINT ["wp-buildkit"]
